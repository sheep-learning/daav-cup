---
title: "Daav Cup"
author: "(by TD Sheep)"
output: 
  flexdashboard::flex_dashboard:
    theme: 
      version: 4
      bg: "#edf4ff"
      fg: "#0f49a6" 
      primary: "gold"
      base_font: 
        google: Prompt
      heading_font:
        google: Sen
      code_font:
        google: 
          # arguments to sass::font_google() 
          family: JetBrains Mono
          local: false
    vertical_layout: fill
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(knitr)
library(flexdashboard)
library(RColorBrewer)
library(plotly)
library(kableExtra)
load('utils/functions/data_functions.RData')
load('utils/functions/table_functions.RData')
load('utils/vars/team_data.RData')
load('utils/vars/cars_df.RData')
```

# Day 1 - Oasis

```{r}
# Day 1 matches
top <- c(1,2,3)
mid <- c(4,5,6)
bot <- c(7,8,9)
```

```{r}
day1_raw <- read_csv('data/daav_cup_results - Day1.csv') 

day1_results <- map_dfr(1:nteams, ~getResults(day1_raw, .x, npools)) %>%
  cutNames()

day1_summary <- getSummary(day1_results)

# NOTE: for day 1, standings and mvp are initialised differently
standings1 <- arrange(day1_summary,Team) %>%
  arrange(desc(Points)) %>%
  mutate(Rank = 1:nteams, .before=1)

mvp <- day1_results %>%
  arrange(desc(Points)) %>%
  mutate(Rank = 1:(nteams*npools), Team = NULL, .before=1)

positions <- getPositions(day1_results)
```

Column {data-width=250}
--------------
### Top Bracket
```{r}
indivResults(cars_df$day1_top, positions, top)
```
Column {data-width=250}
--------------
### Middle Bracket
```{r}
indivResults(cars_df$day1_mid, positions, mid)
```
Column {data-width=250}
--------------
### Bottom Bracket
```{r}
indivResults(cars_df$day1_bot, positions, bot)
```


# Day 2 - Hairpin

```{r}
# Day 1 matches
top <- c(4,2,8)
mid <- c(9,6,1)
bot <- c(3,5,7)
```

```{r}
day2_raw <- read_csv('data/daav_cup_results - Day2.csv') 
  
day2_results <- map_dfr(1:nteams, ~getResults(day2_raw, .x, npools)) %>%
  cutNames()
  
day2_summary <- getSummary(day2_results) 

standings2 <- getStandings(day2_summary, standings1)

mvp <- getMVP(mvp, day2_results)

positions <- getPositions(day2_results)
```

Column {data-width=250}
--------------
### Top Bracket
```{r}
indivResults(cars_df$day2_top, positions, top)
```
Column {data-width=250}
--------------
### Middle Bracket
```{r}
indivResults(cars_df$day2_mid, positions, mid)
```
Column {data-width=250}
--------------
### Bottom Bracket
```{r}
indivResults(cars_df$day2_bot, positions, bot)
```


# Day 3 - Factory

```{r}
top <- c(8,4,6)
mid <- c(1,5,9)
bot <- c(2,7,3)
```

```{r}
# read in points per team
day3_raw <- read_csv('data/daav_cup_results - Day3.csv') 
  
day3_results <- map_dfr(1:nteams, ~getResults(day3_raw, .x, npools)) %>%
  cutNames()
  
day3_summary <- getSummary(day3_results) 

standings3 <- getStandings(day3_summary, standings2)

mvp <- getMVP(mvp, day3_results)

positions <- getPositions(day3_results)
```

Column {data-width=250}
--------------
### Top Bracket
```{r}
indivResults(cars_df$day3_top, positions, top)
```
Column {data-width=250}
--------------
### Middle Bracket
```{r}
indivResults(cars_df$day3_mid, positions, mid)
```
Column {data-width=250}
--------------
### Bottom Bracket
```{r}
indivResults(cars_df$day3_bot, positions, bot)
```


# Day 4 - River Peak

```{r}
top <- c(8,1,6)
mid <- c(2,4,9)
bot <- c(7,5,3)
```

```{r}
# read in points per team
day4_raw <- read_csv('data/daav_cup_results - Day4.csv') 
  
day4_results <- map_dfr(1:nteams, ~getResults(day4_raw, .x, npools)) %>%
  cutNames()
  
day4_summary <- getSummary(day4_results) 

standings4 <- getStandings(day4_summary, standings3)

mvp <- getMVP(mvp, day4_results)

positions <- getPositions(day4_results)
```

Column {data-width=250}
--------------
### Top Bracket
```{r}
indivResults(cars_df$day4_top, positions, top)
```
Column {data-width=250}
--------------
### Middle Bracket
```{r}
indivResults(cars_df$day4_mid, positions, mid)
```
Column {data-width=250}
--------------
### Bottom Bracket
```{r}
indivResults(cars_df$day4_bot, positions, bot)
```


# Day 5 - Hairpin

```{r}
top <- c(8,1,9)
mid <- c(6,2,7)
bot <- c(5,4,3)
```

```{r}
# read in points per team
day5_raw <- read_csv('data/daav_cup_results - Day5.csv') 
  
day5_results <- map_dfr(1:nteams, ~getResults(day5_raw, .x, npools)) %>%
  cutNames()
  
day5_summary <- getSummary(day5_results) 

standings5 <- getStandings(day5_summary, standings4)

mvp <- getMVP(mvp, day5_results)

positions <- getPositions(day5_results)
```

Column {data-width=250}
--------------
### Top Bracket
```{r}
indivResults(cars_df$day5_top, positions, top)
```
Column {data-width=250}
--------------
### Middle Bracket
```{r}
indivResults(cars_df$day5_mid, positions, mid)
```
Column {data-width=250}
--------------
### Bottom Bracket
```{r}
indivResults(cars_df$day5_bot, positions, bot)
```

# Standings

Column {data-width=125}
--------------
### Day 5 Results
```{r}
dailyResults(day5_summary)
```
Column {data-width=125}
--------------
### Overall Standings
```{r}
dailyResults(standings5)
```
Column {data-width=125}
--------------
### MVP Standings
```{r}
dailyResults(mvp)
```
















